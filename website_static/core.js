var techs = [
	{
		name: "deep learning",
		value: 13.1795937604,
		reason: "A few news articles were very positive on the influence of deep learning.",
		timeseries: [61.34263228038496, 13.13020156704431, 42.95253479054841, 60.72477157595582, 69.92809217636196, 17.567356610362225, 69.05207631285546, 82.4197451161861, 48.4637436606527, 77.58764268581571, 70.56975237420588, 44.52014038194915, 69.48830711080967, 80.96390871923435, 3.684148510499341, 10.425119161452507, 27.72275185641201, 26.203236422539376, 22.024940501748095, 49.51842332361137, 8.002685652428411, 31.2952276404379, 18.411391434924194, 6.423698588839123, 46.13171662960484, 7.368542275322042, 30.469734410154686, 6.043743256848259, 38.11918059281089, 18.611503630917145, 13.1795937604]
	}, {
		name: "computer vision",
		value: 53.6666666667,
		reason: "computer vision is currently trending on some news sites and has a high volume of social media posts that are positive.",
		timeseries: [14.07638048901757, 22.200857712870405, 21.277794213662588, 14.254753468918715, 2.8880577012924533, 22.62035434409068, 69.23798452822372, 37.8089804886319, 67.4964341387863, 72.60070561413947, 53.326064276881134, 12.032673301297187, 41.30433597167222, 10.473673544848339, 16.599201936528686, 21.48923677131929, 32.82223866210067, 39.789293733489686, 20.413975675287883, 39.543326112304335, 46.2515746619385, 38.728013690756605, 44.620844714230316, 46.412180775894505, 33.09131622692165, 53.69246017554646, 52.17400200184829, 53.36686242354624, 50.48661157936943, 52.652008082574035, 53.6666666667]
	}, {
		name: "autonomous vehicles",
		value: 1.04527777778,
		reason: "autonomous vehicles is currently trending on some news sites and has a high volume of social media posts that are positive.",
		timeseries: [12.62124301801882, 11.644248842554635, 11.795965803534518, 8.227795636439966, 10.351571985276454, 14.947035150922158, 11.118515519885456, 18.338305025289564, 12.757649538645335, 11.203267474564758, 87.73284636398887, 27.53354362314485, 56.516011950683854, 64.54766818881384, 60.521925019781925, 22.52890790344326, 20.14242006920112, 23.614232249160295, 28.617872466725334, 25.236265366075948, 2.3591973896924756, 19.874549492034024, 10.279584175812033, 9.049806753135575, 8.8768904155982, 4.994050001081524, 2.3914786538162285, 3.5741393387116114, 1.5005873289036442, 3.517356930772917, 1.04527777778]
	}, {
		name: "siri",
		value: 39.1221803392,
		reason: "siri has a high volume of social media posts that are positive.",
		timeseries: [42.861845753718626, 47.01245032688001, 43.72877880181152, 42.90091207071257, 41.81112190174277, 33.74838310715397, 41.33854334899197, 46.307324815774905, 53.651868441481824, 49.61954464027173, 56.46156262585185, 44.21128143025081, 59.55233882755265, 54.08687173168444, 41.82838325603436, 32.256739650899604, 51.28582286431406, 41.93493451502307, 44.12214293412859, 22.842479857070394, 49.67189735094572, 52.826545824900634, 41.02395020435781, 59.60058924123133, 48.626410663636705, 49.54016368078134, 47.64929168039104, 46.65573448382475, 46.68790222843098, 45.04594235827119, 39.1221803392]
	}, {
		name: "google home",
		value: 67.0,
		reason: "google home is currently trending on some news sites.",
		timeseries: [3.5056960188114124, 4.07077709334352, 0.3237494811509647, 1.2265748228056679, 3.420143929201875, 3.1416278726306697, 5.086157470338396, 6.492648905001773, 6.329736059663244, 6.221992879622849, 1.3805891372742964, 1.3123195328694344, 0.0648106212979318, 2.556450631545685, 2.1727185605602317, 4.098197615658532, 3.8062900692356267, 2.634497254742877, 2.5852403588983464, 5.902559810808129, 4.544301017565949, 4.586873192645044, 3.4122897105161876, 4.353354047331148, 3.745556597234452, 61.026244337885686, 55.002525918645986, 68.61908965073395, 59.14547204300457, 57.841782598440915, 67.0123]
	}, {
		name: "alexa",
		value: 5.69962962963,
		reason: "A few news articles were very positive on the influence of alexa.",
		timeseries: [0.5041501772765127, 0.29603090331812787, 5.015132940160064, 7.911880983984192, 11.256141439028877, 3.778081915140984, 6.392394567901953, 6.2614571655402615, 3.8988759618243125, 6.73249496298966, 3.541473636494754, 0.022115896050521666, 2.4580278452705215, 2.9433321331155766, 3.046340612212118, 6.743801093345744, 6.071695996818765, 1.9495990549439837, 3.052621659821349, 6.248764801830098, 5.468049159645773, 4.459887627690497, 4.654286743610113, 3.0919921930395455, 6.013803476325934, 6.946088162790782, 7.7268217664023435, 6.02939347538476, 1.1623110031416868, 7.376721135785108, 5.69962962963]
	}, {
		name: "blockchain",
		value: 40.1265874253,
		reason: "blockchain is currently trending on some news sites and has a high volume of social media posts that are positive. A few news articles were very positive on the influence of blockchain.",
		timeseries: [48.952435196298424, 39.084474502474706, 43.53845435315304, 25.392965150367342, 20.494608978453822, 32.494835719184685, 40.9726057519661, 51.618176833320895, 47.46562069217282, 33.348219825079475, 32.339075786769, 46.920404467776535, 45.13450282204045, 33.1544071755242, 38.85014796123048, 86.73982752884177, 87.2453168140545, 84.36046855659079, 94.00445095042487, 83.36512930339217, 33.933651043602474, 39.02076483072692, 50.2144871922224, 32.987876754650365, 50.78970832253602, 34.892013073605625, 32.28921347388184, 35.53204511898356, 32.10269357878071, 39.32783038467301, 40.1265874253]
	}, {
		name: "cryptocurrency",
		value: 14.0,
		reason: "cryptocurrency is currently trending on some news sites and has a high volume of social media posts that are positive.",
		timeseries: [22.31366599518535, 28.77223386498057, 26.44906706542922, 22.16707021193171, 22.50972546960231, 26.347209790354604, 12.075194424486472, 24.07586468305309, 40.77283082941679, 35.19387266468243, 28.11054067102833, 28.05147062647002, 28.78703599045633, 29.47687645170031, 29.404954212249738, 69.86030803035028, 69.60536043731918, 65.47999735160921, 63.868832826037185, 68.94260669440862, 34.96784800978716, 31.866612334055738, 31.697571048022148, 31.064411525951993, 34.14844545078286, 21.63073400411473, 23.561975977645425, 31.892003411083927, 21.096461806422777, 30.895714215681316, 14.0]
	}
];


// [('Deep Learning', 162.94512604270233), ('Smart Assistants', 208.33199581169339), ('Blockchain', 48.871825409191715)]

var calculated_weights = [10.34813, 1.2];

// elements
var cols = [$("#db-1"), $("#db-2"), $("#db-3"), $("#db-4"), $("#db-5")];

function render(xlist, sort) {
	var list = xlist;
	if (sort) list = list.sort((a, b) => b.value - a.value);

	// for each col
	for (var i = 0; i < cols.length; i++) {
		cols[i].html("");

		// for each tech
		for (var j = 0; j < list.length; j++) {
			var dis = (list[j].value < i * calculated_weights[0]) ? "disabled" : "";
			var t = `<div class="tech t${j + 1} ${dis}" style="min-height:${list[j].value * calculated_weights[1]}px"><p>${list[j].name} <span class="score">${list[j].value.toFixed(2)}</span></p></div>`;
			cols[i].append(t);
		}
	}
}

render(techs, false);

// our picks
var list = techs.sort((a, b) => b.value - a.value);

var picks = $("#db-6");
var pick_details = $("#db-7");

for (var i = 0; i < 4; i++) {
	var t = `<div class="tech t${i + 1}" style="min-height:30px"><p>${list[i].name} <span class="score">${list[i].value.toFixed(2)}</span></p></div>`;
	picks.append(t);

	var d = `<h3>${list[i].name} (${list[i].value.toFixed(2)})</h3>`;
	d += `<p>${list[i].reason}</p>`;
	d += `<svg width="400" height="300" id="graph-${i}"></svg>`;
	pick_details.append(d);

	var svg = d3.select(`svg#graph-${i}`),
	    margin = {top: 20, right: 20, bottom: 20, left: 20},
	    width = +svg.attr("width") - margin.left - margin.right,
	    height = +svg.attr("height") - margin.top - margin.bottom,
	    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	var x = d3.scaleLinear()
	    .rangeRound([0, width]);

	var y = d3.scaleLinear()
	    .rangeRound([height, 0]);

	var line = d3.line()
		.x(function(d, i) { return x(i); })
		.y(function(d) { return y(d); });

	x.domain(d3.extent(list[i].timeseries, function(d, i) { return i; }));
	y.domain(d3.extent(list[i].timeseries, function(d) { return d; }));

	g.append("path")
		.datum(list[i].timeseries)
		.attr("fill", "none")
		.attr("stroke", "#53A0FD")
		.attr("stroke-linejoin", "round")
		.attr("stroke-linecap", "round")
		.attr("stroke-width", 1.5)
		.attr("d", line);
}

// sort button
$("#sort-btn").on("click", function() {
	render(techs, true);
	$(this).remove();
});